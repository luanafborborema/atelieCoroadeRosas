<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ateliê Coroa de Rosas</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <nav class="navbar">
        <div class="menu-hamburguer" id="menu-hamburguer">&#9776;</div>
        <div class="logo"><a href="index.html"><img src="imagens/logo.coroaderosas.png" alt="Logo"></a></div>
    </nav>
</header>

<aside class="menu-lateral" id="menu-lateral">
    <div class="menu-lateral-header">
        <div class="logo-menu"><img src="imagens/logo.coroaderosas.png" alt="Logo"></div>
        <div class="menu-fechar" id="menu-fechar">&times;</div>
    </div>
    <ul>
        <li><a href="#pulseiras">Pulseiras</a></li>
        <li><a href="#chaveiros">Chaveiros</a></li>
        <li><a href="#tercos">Terços</a></li>
        <li><a href="#" onclick="abrirPopupContato(event)">Contato</a></li>
    </ul>
</aside>

<main>
    <section id="tercos">
        <h2>Terços</h2>
        <div class="produtos-container" id="lista-tercos"></div>
    </section>

    <hr class="section-divider">

    <section id="chaveiros">
        <h2>Chaveiros</h2>
        <div class="produtos-container" id="lista-chaveiros"></div>
    </section>

    <hr class="section-divider">

    <section id="pulseiras">
        <h2>Pulseiras</h2>
        <div class="produtos-container" id="lista-pulseiras"></div>
    </section>
</main>

<footer>
    <div class="footer-content">
        <p>Desenvolvido por Ateliê Coroa de Rosas</p>
        <p>© 2024 - <span id="adminLink" style="cursor: pointer;">Todos os direitos reservados</span></p>
    </div>
</footer>

<!-- Modal de detalhes -->
<div class="modal-overlay" id="detalhesModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalNome"></h2>
            <span class="modal-close" onclick="fecharDetalhes()">&times;</span>
        </div>
        <div class="modal-body">
            <div class="modal-gallery">
                <div class="main-image-container"><img src="" alt="Imagem Principal" id="modalImagemPrincipal"></div>
                <div class="thumbnail-container" id="thumbnailContainer"></div>
            </div>
            <p id="modalDescricao"></p>
            <div id="modal-extra-details"></div>
            <span id="modalPreco" class="price"></span>
        </div>
    </div>
</div>

<!-- Modal de contato -->
<div class="modal-overlay" id="contatoModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Fale Conosco</h2>
            <span class="modal-close" onclick="fecharPopupContato()">&times;</span>
        </div>
        <div class="modal-body">
            <ul class="contact-popup-list" id="contatoList"></ul>
        </div>
    </div>
</div>

<script>
    const API_URL =
        (location.hostname === 'localhost' || location.hostname === '127.0.0.1')
            ? 'http://localhost:5000'
            : 'https://atelie-backend-luana.onrender.com';

    document.getElementById('adminLink').addEventListener('click', () => {
        window.location.href = 'admin.html';
    });

    document.addEventListener('DOMContentLoaded', function () {
        const menuHamburguer = document.getElementById('menu-hamburguer');
        const menuLateral = document.getElementById('menu-lateral');
        const menuFechar = document.getElementById('menu-fechar');
        const body = document.body;

        menuHamburguer.addEventListener('click', () => {
            menuLateral.classList.add('show');
            body.classList.add('menu-open');
        });

        menuFechar.addEventListener('click', () => {
            menuLateral.classList.remove('show');
            body.classList.remove('menu-open');
        });

        document.addEventListener('click', (event) => {
            if (!menuLateral.contains(event.target) &&
                !menuHamburguer.contains(event.target) &&
                menuLateral.classList.contains('show')) {
                menuLateral.classList.remove('show');
                body.classList.remove('menu-open');
            }
        });

        carregarProdutos();
        carregarContatos();
    });

    // ---------------------- CARREGAR PRODUTOS ----------------------
    async function carregarProdutos() {
        try {
            const response = await fetch(`${API_URL}/api/products/list`);
            if (!response.ok) throw new Error('Erro ao carregar produtos.');

            const produtos = await response.json();

            const containers = {
                tercos: document.getElementById('lista-tercos'),
                chaveiros: document.getElementById('lista-chaveiros'),
                pulseiras: document.getElementById('lista-pulseiras')
            };

            Object.values(containers).forEach(c => c.innerHTML = '');

            produtos.forEach(p => {
                const categoriaKey = (p.categoria || '').toLowerCase();
                const container = containers[categoriaKey];
                const imagemCapa = (p.imagens?.[0]) || p.imagem;

                if (container && imagemCapa) {
                    container.innerHTML += `
                        <div class="produto" onclick="mostrarDetalhes('${p._id}')">
                            <img src="${imagemCapa}" alt="${p.nome}">
                            <h3>${p.nome}</h3>
                            <p>${(p.descricao || '').substring(0, 80)}${(p.descricao || '').length > 80 ? '...' : ''}</p>
                            <span>R$ ${(p.preco || 0).toFixed(2).replace('.', ',')}</span>
                        </div>`;
                }
            });

        } catch (error) {
            console.error(error);
            document.querySelectorAll('.produtos-container')
                .forEach(c => c.innerHTML = '<p>Erro ao carregar produtos.</p>');
        }
    }

    // ---------------------- CARREGAR CONTATOS ----------------------
    async function carregarContatos() {
        try {
            const response = await fetch(`${API_URL}/api/contacts/get`);
            if (response.ok) window.contatosDoBanco = await response.json();
        } catch (error) {
            console.error('Erro ao carregar contatos:', error);
        }
    }

    // ---------------------- MODAL DE DETALHES ----------------------
    const modal = document.getElementById('detalhesModal');

    async function mostrarDetalhes(id) {
        try {
            const response = await fetch(`${API_URL}/api/products/${id}`);
            if (!response.ok) throw new Error('Produto não encontrado.');

            const p = await response.json();

            document.getElementById('modalNome').innerText = p.nome;
            document.getElementById('modalDescricao').innerText = p.descricao;
            document.getElementById('modalPreco').innerText = `R$ ${(p.preco || 0).toFixed(2).replace('.', ',')}`;

            const imgPrincipal = document.getElementById('modalImagemPrincipal');
            const thumbContainer = document.getElementById('thumbnailContainer');

            thumbContainer.innerHTML = '';

            const imagens = p.imagens?.length ? p.imagens : (p.imagem ? [p.imagem] : []);

            if (imagens.length > 0) {
                imgPrincipal.src = imagens[0];

                imagens.forEach((img, index) => {
                    const thumb = document.createElement('img');
                    thumb.src = img;
                    thumb.className = 'thumbnail';
                    if (index === 0) thumb.classList.add('active');

                    thumb.onclick = () => {
                        imgPrincipal.src = img;
                        document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
                        thumb.classList.add('active');
                    };

                    thumbContainer.appendChild(thumb);
                });
            }

            let detailsHTML = '';
            if (p.pedrasAveMaria) detailsHTML += `<p><strong>Contas (Ave-Maria):</strong> ${p.pedrasAveMaria}</p>`;
            if (p.pedrasPaiNosso) detailsHTML += `<p><strong>Contas (Pai Nosso):</strong> ${p.pedrasPaiNosso}</p>`;
            if (p.detalhesCrucifixo) detailsHTML += `<p><strong>Crucifixo e Entremeio:</strong> ${p.detalhesCrucifixo}</p>`;
            if (p.divisao) detailsHTML += `<p><strong>Divisões:</strong> ${p.divisao}</p>`;

            document.getElementById('modal-extra-details').innerHTML = detailsHTML;

            modal.classList.add('show');

        } catch (error) {
            console.error(error);
            alert('Erro ao abrir detalhes do produto.');
        }
    }

    function fecharDetalhes() {
        modal.classList.remove('show');
    }

    modal.addEventListener('click', (event) => {
        if (event.target === modal) fecharDetalhes();
    });

    // ---------------------- MODAL DE CONTATO ----------------------
    const contatoModal = document.getElementById('contatoModal');

    function abrirPopupContato(event) {
        event.preventDefault();

        const lista = document.getElementById('contatoList');
        lista.innerHTML = '';

        const c = window.contatosDoBanco;

        if (!c) {
            lista.innerHTML = '<li>Contatos indisponíveis no momento.</li>';
            contatoModal.classList.add('show');
            return;
        }

        if (c.whatsapp) {
            const num = c.whatsapp.replace(/\D/g, '');
            lista.innerHTML += `
                <li>
                    <a href="https://wa.me/${num}" target="_blank">WhatsApp: ${c.whatsapp}</a>
                </li>`;
        }

        if (c.instagram) {
            lista.innerHTML += `
                <li><a href="${c.instagram}" target="_blank">Instagram</a></li>`;
        }

        if (c.facebook) {
            lista.innerHTML += `
                <li><a href="${c.facebook}" target="_blank">Facebook</a></li>`;
        }

        contatoModal.classList.add('show');
    }

    function fecharPopupContato() {
        contatoModal.classList.remove('show');
    }

    contatoModal.addEventListener('click', (event) => {
        if (event.target === contatoModal) fecharPopupContato();
    });
</script>

</body>
</html>
